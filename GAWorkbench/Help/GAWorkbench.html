<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="949.54">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p5 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p6 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica}
p.p7 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 85.0px; text-indent: -85.0px; font: 12.0px Helvetica}
p.p9 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica}
p.p10 {margin: 0.0px 0.0px 0.0px 57.0px; text-indent: -57.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #a81914}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0910ba}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
span.s1 {font: 18.0px Helvetica}
span.s2 {color: #1a27ed}
span.s3 {font: 9.0px Monaco}
span.s4 {color: #0910ba}
span.s5 {color: #000000}
span.s6 {color: #606060}
span.s7 {color: #a81914}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>GAWorkbench<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>a general purpose modular genetic algorithm workbench</b><span class="s1"><b><span class="Apple-tab-span">	</span></b></span></p>
<p class="p2"><br></p>
<p class="p1"><b>Inherits from: </b><a href="SC://Object"><span class="s2"><b>Object</b></span></a></p>
<p class="p3"><br></p>
<p class="p1">This is a general purpose and modular genetic algorithm workbench class for SuperCollider. Genetic algorithms employ a search technique to find fit solutions to search and optimization problems. They use techniques derived from evolutionary biology like inheritance, mutation, (artificial) selection and crossover.</p>
<p class="p2"><br></p>
<p class="p1">For more info on the subject see:</p>
<p class="p1">http://en.wikipedia.org/wiki/Genetic_algorithm</p>
<p class="p2"><br></p>
<p class="p1">GAWorkbench is a general purpose workbench that provides an easy interface to collect and interact with your data to be used with evolutionary techniques. Can be used for solving general ocmputational problems and can also be used for exploring sound spaces, fit parameters for synthesis networks etc. This quark also includes a GAExplorer class which is designed for finding suitable parameters for synthesis graphs towards a particular goal. See its help file for sound examples.</p>
<p class="p2"><br></p>
<p class="p1"><b>See also:</b> GAExplorer</p>
<p class="p2"><br></p>
<p class="p4"><b>Creation / Class Methods</b></p>
<p class="p5"><br></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>*new (argPoolSize, argRandomChromosomeFunc, argFitnessFunc, argMutationFunc)</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>argPoolSize </b>- Number of items in the gene pool. Should be tuned for each problem. default: 100</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>argRandomChromosomeFunc </b>- A Function. This function should return a randomly generated</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chromosome formatted in your chosen way of<span class="Apple-converted-space">  </span>encoding for the problem.</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>argFitnessFunc </b>- A Function. Each organism defined by the chromosomes in your gene pool</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>will pass through this function, and this function will be passed in the chromosome as</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>an argument. You should rate the fitness of it and return the fitness value from this function.</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>argMutationFunc </b>- When a chromosome will be mutated, it will be sent into this func, you should</p>
<p class="p8"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>grab it as an argument, mutate it to yout hearts content and return the mutated chromosome.</p>
<p class="p5"><br></p>
<p class="p9"><b>Accessing Instance and Class Variables</b></p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>mutationProb_(arg1)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>mutationProb</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>The mutation probability, should be between 0 and 1. Default: 0.08</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>randImmigrantProb_(arg1)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>randImmigrantProb</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Genetic algorithms tend to diverge to a local optimum for a problem. To remedy this, totally</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>new immigrants are added to the gene pool in some iterations. This variable sets the probabilty</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>of random immigrants being introduced to the system. Should be between 0 and 1. Default is 0.</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>externalCrossover_(arg1)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>externalCrossover</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>The crossover functionality provided with this class is simple. If you need to craft and use</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>a custom crossover function, you should set this variable to <i>true</i> (boolean) and provide a</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>userCrossover</b> function as an instance variable.</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>The external crossover function will be passed in this arguments, in given order:</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>genePool: </b>The whole gene pool as an Array.</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>isElitist: </b>Value of the isElitist instance variable for the instance.</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>mutationProb:</b> Value of the mutation probability for the instance.</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>randImmigrantProb:</b> Value of the random immigrant probabilty for the instance.</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>allowClones: </b>Value of the allowclones variable for the instance.</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>You should grab those arguments in your custom crossover function, and return the</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>new genePool from your function. Default value is false.</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>allowClones_(arg1)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>allowClones</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>If you are working with small gene pools, setting this to false ensures that each of your</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chromosomes are unique after the crossover operation. Default is true (allows clones,</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>not all items will be unique).</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>isElitist_(arg1)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>isElitist</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>If this is set to true, the fittest organism of the pool will go unchanged to the next generation.</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Default is true.</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>genePool</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>The whole gene pool ordered from fittest to weakest.</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>fitnessScores</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>The fitness scores for the items in the gene pool in the same order.</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>userCrossover_(arg1)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>userCrossover</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Custom crossover function to be supplied by the user. See the help for externalCrossover</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>variable. default is nil.</p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><b>lowerBetter_(arg1)</b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>lowerBetter</b></p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>A boolean value. If set to true, lower values returned from the fitness function are fitter.</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Default is false.</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p9"><b>Doing Some Task (optional)</b></p>
<p class="p10"><br></p>
<p class="p6"><span class="s3"><span class="Apple-tab-span">	</span></span><b>rateFitness</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Rates the fitness of the genePool and sorts the chromosomes inside genePool from the</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>highest fitness to lowest.</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>crossover</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>Applies the crossover function to the members of the genePool. Mutations are made and</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>random immigrants are injected according to their probabilities (mutationProb and</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>randImmigrantProb)</p>
<p class="p7"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5"><br></p>
<p class="p6"><b><span class="Apple-tab-span">	</span>injectFitness (argFitness)</b></p>
<p class="p7"><b><span class="Apple-tab-span">	</span></b></p>
<p class="p6"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>If you want to calculate the fitness values for te members of the genePool outside the class,</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>and supply them by your own, you should use this method. argFitness is an array, which rates<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>the fitness of the members of the genePool. The members of the genePool is ordered according</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>to their fitnesses as in the rateFitness method automatically inside this method.</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p9"><b>Examples</b></p>
<p class="p3"><br></p>
<p class="p6">A simple example: We want to reach to a target value (4242) with a mathematical expression composed of</p>
<p class="p6">17 operators and digits. So the expression is composed in [digit operator digit operator ...] formation. We are<span class="Apple-converted-space"> </span></p>
<p class="p6">searching for the expression. poolSize is 100, and we will find the fittest expression after 50 generations.</p>
<p class="p7"><br></p>
<p class="p11">(</p>
<p class="p12">//this will take a few seconds to complete.</p>
<p class="p3"><br></p>
<p class="p12"><span class="s4">var</span><span class="s5"> digits = </span><span class="s6">"0123456789"</span><span class="s5">; </span>//allowed digits</p>
<p class="p12"><span class="s4">var</span><span class="s5"> operators = </span><span class="s6">"+-*/%"</span><span class="s5">; </span>//allowed operators</p>
<p class="p11"><span class="s4">var</span> poolSize = 100, chromLength = 17;</p>
<p class="p11"><span class="s4">var</span> target = 4242;</p>
<p class="p11"><span class="s4">var</span> numGenerations = 50;</p>
<p class="p12"><span class="s4">var</span><span class="s5"> inGeneration = 0; </span>//current generation</p>
<p class="p3"><br></p>
<p class="p11"><span class="s4">var</span> randChromFunc =</p>
<p class="p11"><span class="Apple-tab-span">	</span>{</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> randChrom = <span class="s4">List</span>.new;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chromLength.do</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>({</span>|cnt|</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if(cnt.even,</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>{</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>randChrom.add(digits.choose);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>},</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>{</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>randChrom.add(operators.choose);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>randChrom; <span class="s7">//.postln;</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="s4">var</span> fitnessFunc =<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span>{</span>|chrom|</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> result;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chrom = chrom.as(<span class="s4">String</span>);</p>
<p class="p12"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//if the result is inf (divide by zero etc), bigger numbers are</p>
<p class="p12"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//weaker here so they won't be fit. We set NaN's as inf.</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>result = (chrom.interpret - target).abs;<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if(result.isNaN, { result = <span class="s4">inf</span>; });</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>result;</p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="s4">var</span> mutationFunc =</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span>{</span>|chrom|</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> index = chromLength.rand;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if(index.even, { chrom[index] = digits.choose; }, { chrom[index] = operators.choose; });</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chrom;</p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="s4">var</span> gaInstance = <span class="s4">GAWorkbench</span>(poolSize, randChromFunc, fitnessFunc, mutationFunc);</p>
<p class="p3"><br></p>
<p class="p11">gaInstance.mutationProb = 0.1;</p>
<p class="p11">gaInstance.randImmigrantProb = 0.1;</p>
<p class="p11">gaInstance.allowClones = <span class="s4">false</span>;</p>
<p class="p12">//Lower values are better. Our fitness function calculates the difference from the target.</p>
<p class="p11">gaInstance.lowerBetter = <span class="s4">true</span>;<span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p11">block</p>
<p class="p13"><span class="s5">({</span>|break|</p>
<p class="p3"><br></p>
<p class="p11"><span class="Apple-tab-span">	</span>numGenerations.do</p>
<p class="p11"><span class="Apple-tab-span">	</span>({</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gaInstance.rateFitness;</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//if an exact solution is found, break the loop.</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if(gaInstance.genePool[0].as(<span class="s4">String</span>).interpret == target, { break.value; });</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gaInstance.crossover;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>inGeneration = inGeneration + 1;</p>
<p class="p11"><span class="Apple-tab-span">	</span>});</p>
<p class="p11">});</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p11">gaInstance.rateFitness;</p>
<p class="p14">"Target value was % and reached value after % generations is: %"</p>
<p class="p11"><span class="Apple-tab-span">	</span>.format(target, inGeneration, gaInstance.genePool[0].as(<span class="s4">String</span>).interpret).postln;</p>
<p class="p11">(<span class="s6">"The operation was:"</span> + gaInstance.genePool[0].as(<span class="s4">String</span>)).postln;</p>
<p class="p3"><br></p>
<p class="p11">)</p>
<p class="p3"><br></p>
<p class="p6"><b>Another example:</b></p>
<p class="p7"><br></p>
<p class="p6">Travelling salesman problem. We have 25 cities to visit, we start from the red city and want to visit each city</p>
<p class="p6">only and only once, then come back to our origin in the shortest path possible. With a brute-force approach,<span class="Apple-converted-space"> </span></p>
<p class="p6">one needs to check 15511210043330985984000000 different paths to find the shortest route (for 25 cities),</p>
<p class="p6">(which is not feasible) so genetic algorithms provides us an easy optimization method for finding a nice<span class="Apple-converted-space"> </span></p>
<p class="p6">enough path in very little time. This code will show the fittest route in each generation for randomly selected<span class="Apple-converted-space"> </span></p>
<p class="p6">points in a 2d space. Be aware that there is no way to find out that a given solution is the global optimum. In<span class="Apple-converted-space"> </span></p>
<p class="p6">fact, the method used here converges to a local optimum pretty quickly but hopefully the route will converge to<span class="Apple-converted-space"> </span></p>
<p class="p6">something with an high fitness. The chromosome encoding scheme here is left as an exercise for the reader. :)</p>
<p class="p7"><br></p>
<p class="p11">(</p>
<p class="p11"><span class="s4">var</span> numPoints, points, randChromFunc, mutationFunc, fitnessFunc,<span class="Apple-converted-space"> </span></p>
<p class="p11">chromInterpreter, gaInstance, win, view, drawPaths, routine;</p>
<p class="p12">//problem</p>
<p class="p11">numPoints = 25;</p>
<p class="p11">points = { 500.0.rand@500.0.rand } ! numPoints;</p>
<p class="p3"><br></p>
<p class="p12">//ga funcs</p>
<p class="p11">randChromFunc =<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span>{<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(numPoints - 1, (numPoints - 2) .. 1).collect</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>({<span class="s4">|cnt|</span><span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p12"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//cnt.rand;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(exprand(1, cnt) - 1).floor;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p11">mutationFunc =<span class="Apple-converted-space"> </span></p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span>{</span>|chrom|<span class="s5"><span class="Apple-converted-space"> </span></span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> randIndex = (chrom.size - 1).rand;</p>
<p class="p12"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//chrom[randIndex] = (numPoints - randIndex - 2).rand;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chrom[randIndex] = (exprand(1, (numPoints - randIndex - 2)) - 1).floor;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>chrom;</p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p11">fitnessFunc =</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span>{</span>|chrom|</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> pathIndexes = chromInterpreter.value(chrom);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> totalDistance = 0;</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(numPoints).do</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>({</span>|cnt|</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>totalDistance = totalDistance + points[pathIndexes[cnt]].dist(points[pathIndexes[(cnt+1) % numPoints]]);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>totalDistance.reciprocal;<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p3"><br></p>
<p class="p12"><span class="s5">chromInterpreter = </span>//this chunk of code is shared between fitness function and visualization</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span>{</span>|chrom|</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> ptsToGo = (1, 2 .. numPoints - 1);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> travellerIsIn = 0;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> currentDistances, curDistOrders;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> pathIndexes = <span class="s4">List</span>.new;</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(numPoints - 1).do</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>({</span>|inHop|</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>currentDistances =<span class="Apple-converted-space"> </span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>ptsToGo.collect</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>({</span>|pntIndex|</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>points[travellerIsIn].dist(points[pntIndex]);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>curDistOrders = currentDistances.order.order;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pathIndexes.add(ptsToGo[curDistOrders.detectIndex({<span class="s4">|item|</span> item == chrom[inHop]; })]);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>ptsToGo.remove(pathIndexes.last);</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>travellerIsIn = pathIndexes.last;<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pathIndexes.add(0);</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pathIndexes;</p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p3"><br></p>
<p class="p11">gaInstance = <span class="s4">GAWorkbench</span>.new(100, randChromFunc, fitnessFunc, mutationFunc);</p>
<p class="p11">gaInstance.allowClones = <span class="s4">false</span>;</p>
<p class="p11">gaInstance.mutationProb = 0.2;</p>
<p class="p11">gaInstance.randImmigrantProb = 0.1;</p>
<p class="p11">gaInstance.isElitist = <span class="s4">false</span>;</p>
<p class="p3"><br></p>
<p class="p11">win = <span class="s4">Window</span>.new(<span class="s6">"TSP"</span>, <span class="s4">Rect</span>(300, 300, 500, 500));</p>
<p class="p11">view = <span class="s4">UserView</span>(win, win.view.bounds).background_(<span class="s4">Color</span>.black)</p>
<p class="p11"><span class="Apple-tab-span">	</span>.drawFunc_</p>
<p class="p11"><span class="Apple-tab-span">	</span>({</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> fittest = gaInstance.genePool[0];</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>points.do</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>({</span>|pnt, cnt|</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">Pen</span>.color = if(cnt == 0, { <span class="s4">Color</span>.red; }, { <span class="s4">Color</span>.white; });</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">Pen</span>.fillOval(<span class="s4">Rect</span>(pnt.x - 4, pnt.y - 4, 8, 8));</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>drawPaths.value(fittest);</p>
<p class="p11"><span class="Apple-tab-span">	</span>});</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11">drawPaths =</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span>{</span>|chrom|</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">var</span> pathIndexes = chromInterpreter.value(chrom);</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(numPoints).do</p>
<p class="p13"><span class="s5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>({</span>|cnt|</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">Pen</span>.line(points[pathIndexes[cnt]], points[pathIndexes[(cnt+1) % numPoints]]);</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s4">Pen</span>.stroke;</p>
<p class="p11"><span class="Apple-tab-span">	</span>};</p>
<p class="p3"><span class="Apple-tab-span">	</span></p>
<p class="p11">win.front;</p>
<p class="p11">win.onClose_({ routine.stop; });</p>
<p class="p3"><br></p>
<p class="p11">routine = {</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="s4">inf</span>.do</p>
<p class="p11"><span class="Apple-tab-span">	</span>({</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gaInstance.crossover;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>gaInstance.rateFitness;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>win.refresh;</p>
<p class="p11"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0.2.wait;</p>
<p class="p11"><span class="Apple-tab-span">	</span>});</p>
<p class="p11">}.fork(<span class="s4">AppClock</span>);</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p11">)</p>
<p class="p3"><br></p>
<p class="p6"><b>Sound example:</b></p>
<p class="p7"><br></p>
<p class="p6">For dealing with sounds and interactive fitness evaluation, tbc...</p>
</body>
</html>
